# CloudPose è´Ÿè½½æµ‹è¯•å®éªŒå®Œæ•´æŒ‡å¯¼

æœ¬æŒ‡å¯¼æ–‡æ¡£å°†å¸®åŠ©æ‚¨å®ŒæˆAssignmentç¬¬7èŠ‚è¦æ±‚çš„è´Ÿè½½æµ‹è¯•å®éªŒå’ŒæŠ¥å‘Šæ’°å†™ã€‚

## ğŸ“‹ å®éªŒæ¦‚è¿°

æ ¹æ®Assignmentè¦æ±‚ï¼Œæ‚¨éœ€è¦ï¼š
1. æµ‹è¯•ç³»ç»Ÿåœ¨ä¸åŒPodæ•°é‡(1,2,4,8)ä¸‹çš„æœ€å¤§è´Ÿè½½æ‰¿å—èƒ½åŠ›
2. ä½¿ç”¨Locustè¿›è¡Œå¹¶å‘ç”¨æˆ·æµ‹è¯•ï¼Œæ”¯æŒ128ä¸ªå›¾åƒçš„RESTful APIè°ƒç”¨
3. ç›‘æ§å“åº”æ—¶é—´ã€QPSå’Œé”™è¯¯ç‡
4. ç”ŸæˆåŒ…å«è¡¨æ ¼å’Œåˆ†æçš„å®éªŒæŠ¥å‘Š

## ğŸ› ï¸ ç¯å¢ƒå‡†å¤‡

### 1. å®‰è£…ä¾èµ–

```bash
# å®‰è£…Locustè´Ÿè½½æµ‹è¯•å·¥å…·
pip install locust

# å®‰è£…å…¶ä»–ä¾èµ–
pip install requests psutil
```

### 2. éªŒè¯æ–‡ä»¶ç»“æ„

ç¡®ä¿æ‚¨çš„é¡¹ç›®ç›®å½•åŒ…å«ä»¥ä¸‹æ–‡ä»¶ï¼š

```
client/
â”œâ”€â”€ locustfile.py                    # Locustæµ‹è¯•è„šæœ¬
â”œâ”€â”€ run_experiments.py               # è‡ªåŠ¨åŒ–å®éªŒè„šæœ¬
â”œâ”€â”€ prepare_test_images.py           # æµ‹è¯•å›¾åƒå‡†å¤‡è„šæœ¬
â”œâ”€â”€ experiment_report_template.md    # æŠ¥å‘Šæ¨¡æ¿
â”œâ”€â”€ inputfolder/                     # åŒ…å«128ä¸ªæµ‹è¯•å›¾åƒ
â”œâ”€â”€ backend/                         # åç«¯æœåŠ¡ä»£ç 
â”‚   â”œâ”€â”€ app.py
â”‚   â”œâ”€â”€ Dockerfile
â”‚   â””â”€â”€ ...
â””â”€â”€ EXPERIMENT_GUIDE.md             # æœ¬æŒ‡å¯¼æ–‡æ¡£
```

## ğŸš€ å®éªŒæ‰§è¡Œæ­¥éª¤

### æ­¥éª¤1: å‡†å¤‡æµ‹è¯•å›¾åƒ

```bash
# ä»inputfolderå¤åˆ¶128ä¸ªå›¾åƒåˆ°test_imagesç›®å½•
python prepare_test_images.py

# éªŒè¯å›¾åƒå‡†å¤‡æƒ…å†µ
python prepare_test_images.py verify
```

é¢„æœŸè¾“å‡ºï¼š
```
CloudPose æµ‹è¯•å›¾åƒå‡†å¤‡è„šæœ¬
==================================================
åœ¨ 'inputfolder' ä¸­æ‰¾åˆ° 120 ä¸ªå›¾åƒæ–‡ä»¶
é€‰æ‹©å‰ 120 ä¸ªå›¾åƒè¿›è¡Œæµ‹è¯•
åˆ›å»ºç›®æ ‡ç›®å½•: test_images
...
æµ‹è¯•å›¾åƒå‡†å¤‡å®Œæˆ!
```

### æ­¥éª¤2: å¯åŠ¨åç«¯æœåŠ¡

#### é€‰é¡¹A: æœ¬åœ°è¿è¡Œ

```bash
# è¿›å…¥åç«¯ç›®å½•
cd backend

# å¯åŠ¨æœåŠ¡
python run.py
```

#### é€‰é¡¹B: Dockerè¿è¡Œ

```bash
# æ„å»ºDockeré•œåƒ
cd backend
docker build -t cloudpose-api .

# è¿è¡Œå®¹å™¨
docker run -p 8000:8000 cloudpose-api
```

#### é€‰é¡¹C: Kuberneteséƒ¨ç½²

```bash
# éƒ¨ç½²åˆ°Kubernetes
kubectl apply -f k8s/

# æ£€æŸ¥æœåŠ¡çŠ¶æ€
kubectl get pods
kubectl get services
```

### æ­¥éª¤3: éªŒè¯æœåŠ¡å¯ç”¨æ€§

```bash
# æ£€æŸ¥å¥åº·çŠ¶æ€
curl http://localhost:8000/health

# æˆ–è€…å¯¹äºKubernetes
curl http://your-k8s-cluster-ip:30080/health
```

é¢„æœŸå“åº”ï¼š
```json
{
  "status": "healthy",
  "model_loaded": true,
  "timestamp": "2024-01-20T10:30:00Z"
}
```

### æ­¥éª¤4: æ‰§è¡Œè´Ÿè½½æµ‹è¯•å®éªŒ

#### æ–¹æ³•A: è‡ªåŠ¨åŒ–å®éªŒï¼ˆæ¨èï¼‰

```bash
# æœ¬åœ°æµ‹è¯•
python run_experiments.py --host http://localhost:8000 --mode local

# Kubernetesé›†ç¾¤æµ‹è¯•
python run_experiments.py --host http://your-k8s-cluster-ip:30080 --mode k8s

# è‡ªå®šä¹‰é…ç½®
python run_experiments.py --host http://localhost:8000 --pods 1,2,4 --users 10,20,50 --duration 300
```

#### æ–¹æ³•B: æ‰‹åŠ¨æµ‹è¯•

```bash
# å•ä¸ªå®éªŒç¤ºä¾‹
locust -f locustfile.py --host=http://localhost:8000 --users 50 --spawn-rate 5 --run-time 300s --headless --csv results_50users
```

### æ­¥éª¤5: Kubernetes Podæ‰©å±•ï¼ˆå¦‚æœä½¿ç”¨K8sï¼‰

åœ¨è¿è¡Œä¸åŒPodæ•°é‡çš„æµ‹è¯•æ—¶ï¼Œéœ€è¦æ‰‹åŠ¨è°ƒæ•´replicaæ•°é‡ï¼š

```bash
# 1 Pod
kubectl scale deployment cloudpose-deployment --replicas=1

# 2 Pods
kubectl scale deployment cloudpose-deployment --replicas=2

# 4 Pods
kubectl scale deployment cloudpose-deployment --replicas=4

# 8 Pods
kubectl scale deployment cloudpose-deployment --replicas=8

# éªŒè¯PodçŠ¶æ€
kubectl get pods -l app=cloudpose
```

## ğŸ“Š å®éªŒæ•°æ®æ”¶é›†

### è‡ªåŠ¨åŒ–å®éªŒç»“æœ

è¿è¡Œ`run_experiments.py`åï¼Œä¼šåœ¨`experiments_YYYYMMDD_HHMMSS/`ç›®å½•ä¸‹ç”Ÿæˆï¼š

```
experiments_20240120_103000/
â”œâ”€â”€ experiment_results.json          # å®Œæ•´JSONæ•°æ®
â”œâ”€â”€ experiment_summary.csv           # æ±‡æ€»CSVæ•°æ®
â”œâ”€â”€ experiment_report.md             # è‡ªåŠ¨ç”Ÿæˆçš„æŠ¥å‘Š
â”œâ”€â”€ experiment_1_1pods_10users_*.csv # è¯¦ç»†ç»Ÿè®¡æ•°æ®
â”œâ”€â”€ experiment_1_1pods_10users_*.html # Locust HTMLæŠ¥å‘Š
â””â”€â”€ experiment_1_1pods_10users_*.log  # æµ‹è¯•æ—¥å¿—
```

### å…³é”®æŒ‡æ ‡è¯´æ˜

| æŒ‡æ ‡ | è¯´æ˜ | é‡è¦æ€§ |
|------|------|--------|
| Average Response Time | å¹³å‡å“åº”æ—¶é—´(ms) | ç”¨æˆ·ä½“éªŒæŒ‡æ ‡ |
| P95 Response Time | 95%è¯·æ±‚çš„å“åº”æ—¶é—´ | æ€§èƒ½ç¨³å®šæ€§ |
| Requests/s (QPS) | æ¯ç§’æŸ¥è¯¢æ•° | ååé‡æŒ‡æ ‡ |
| Failure Rate | å¤±è´¥ç‡(%) | ç³»ç»Ÿç¨³å®šæ€§ |
| Request Count | æ€»è¯·æ±‚æ•° | æµ‹è¯•è¦†ç›–åº¦ |

## ğŸ“ æŠ¥å‘Šæ’°å†™æŒ‡å¯¼

### 1. ä½¿ç”¨æŠ¥å‘Šæ¨¡æ¿

```bash
# å¤åˆ¶æ¨¡æ¿å¼€å§‹æ’°å†™
cp experiment_report_template.md my_experiment_report.md
```

### 2. å¡«å†™å®éªŒæ•°æ®

æ ¹æ®å®éªŒç»“æœå¡«å†™ä»¥ä¸‹è¡¨æ ¼ï¼š

```markdown
| # of Pods | Max Users | Avg. Response Time (ms) |
|-----------|-----------|-------------------------|
| 1         | 25        | 145.2                   |
| 2         | 45        | 167.8                   |
| 4         | 85        | 189.3                   |
| 8         | 150       | 201.7                   |
```

### 3. åˆ†æè¦ç‚¹

**å“åº”æ—¶é—´åˆ†æ**:
- æè¿°å“åº”æ—¶é—´éšç”¨æˆ·æ•°å¢åŠ çš„å˜åŒ–è¶‹åŠ¿
- åˆ†æä¸åŒPodé…ç½®çš„æ€§èƒ½å·®å¼‚
- è¯†åˆ«æ€§èƒ½æ‹ç‚¹

**æ‰©å±•æ€§åˆ†æ**:
- è®¡ç®—æ°´å¹³æ‰©å±•æ•ˆç‡ï¼š`(Pod2_QPS - Pod1_QPS) / Pod1_QPS`
- åˆ†æè¾¹é™…æ”¶ç›Šé€’å‡ç°è±¡
- è¯†åˆ«æ‰©å±•ç“¶é¢ˆ

**ç¨³å®šæ€§åˆ†æ**:
- è®°å½•å¼€å§‹å‡ºç°é”™è¯¯çš„è´Ÿè½½æ°´å¹³
- åˆ†æé”™è¯¯ç±»å‹å’ŒåŸå› 
- è¯„ä¼°ç³»ç»Ÿå®¹é”™èƒ½åŠ›

### 4. åˆ†å¸ƒå¼ç³»ç»ŸæŒ‘æˆ˜åˆ†æ

é€‰æ‹©ä¸‰ä¸ªæŒ‘æˆ˜è¿›è¡Œåˆ†æï¼Œä¾‹å¦‚ï¼š

1. **è´Ÿè½½å‡è¡¡**: Kubernetes Serviceå¦‚ä½•åˆ†å‘è¯·æ±‚
2. **å®¹é”™æ€§**: Podæ•…éšœæ—¶çš„ç³»ç»Ÿè¡Œä¸º
3. **èµ„æºç®¡ç†**: CPU/å†…å­˜é™åˆ¶å¯¹æ€§èƒ½çš„å½±å“

## ğŸ”§ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ

#### 1. æµ‹è¯•å›¾åƒåŠ è½½å¤±è´¥

```bash
# æ£€æŸ¥å›¾åƒç›®å½•
ls -la test_images/

# é‡æ–°å‡†å¤‡å›¾åƒ
python prepare_test_images.py clean
python prepare_test_images.py
```

#### 2. æœåŠ¡è¿æ¥å¤±è´¥

```bash
# æ£€æŸ¥æœåŠ¡çŠ¶æ€
curl -v http://localhost:8000/health

# æ£€æŸ¥ç«¯å£å ç”¨
lsof -i :8000

# æ£€æŸ¥é˜²ç«å¢™è®¾ç½®
```

#### 3. Locustæµ‹è¯•å¤±è´¥

```bash
# æ£€æŸ¥Locustç‰ˆæœ¬
locust --version

# éªŒè¯locustfile.pyè¯­æ³•
python -m py_compile locustfile.py

# æŸ¥çœ‹è¯¦ç»†é”™è¯¯æ—¥å¿—
locust -f locustfile.py --host=http://localhost:8000 --loglevel DEBUG
```

#### 4. Kubernetes Podæ‰©å±•é—®é¢˜

```bash
# æ£€æŸ¥DeploymentçŠ¶æ€
kubectl describe deployment cloudpose-deployment

# æ£€æŸ¥Podæ—¥å¿—
kubectl logs -l app=cloudpose

# æ£€æŸ¥èµ„æºé™åˆ¶
kubectl top pods
```

### æ€§èƒ½è°ƒä¼˜å»ºè®®

1. **å¢åŠ æµ‹è¯•æ—¶é•¿**: å¯¹äºç¨³å®šçš„ç»“æœï¼Œå»ºè®®æ¯ä¸ªæµ‹è¯•è¿è¡Œ5-10åˆ†é’Ÿ
2. **è°ƒæ•´ç”Ÿæˆé€Ÿç‡**: æ ¹æ®ç³»ç»Ÿå“åº”è°ƒæ•´`--spawn-rate`å‚æ•°
3. **ç›‘æ§èµ„æºä½¿ç”¨**: ä½¿ç”¨`kubectl top`æˆ–`docker stats`ç›‘æ§èµ„æº
4. **ç½‘ç»œä¼˜åŒ–**: ç¡®ä¿æµ‹è¯•å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„ç½‘ç»œå»¶è¿Ÿæœ€å°

## ğŸ“ˆ ç»“æœéªŒè¯

### æ•°æ®åˆç†æ€§æ£€æŸ¥

1. **å“åº”æ—¶é—´**: åº”è¯¥éšè´Ÿè½½å¢åŠ è€Œå¢é•¿
2. **QPS**: åº”è¯¥éšPodæ•°é‡å¢åŠ è€Œæå‡ï¼ˆä½†å¯èƒ½æœ‰ä¸Šé™ï¼‰
3. **æˆåŠŸç‡**: åœ¨ç³»ç»Ÿå®¹é‡å†…åº”è¯¥ä¿æŒ100%
4. **æ‰©å±•æ•ˆç‡**: 2ä¸ªPodçš„QPSåº”è¯¥æ¥è¿‘1ä¸ªPodçš„2å€

### å®éªŒé‡ç°æ€§

```bash
# é‡å¤å®éªŒéªŒè¯ç»“æœä¸€è‡´æ€§
python run_experiments.py --host http://localhost:8000 --mode local --duration 180
```

## ğŸ“‹ æ£€æŸ¥æ¸…å•

å®éªŒå®Œæˆå‰è¯·ç¡®è®¤ï¼š

- [ ] æµ‹è¯•å›¾åƒå·²å‡†å¤‡ï¼ˆ128ä¸ªï¼‰
- [ ] åç«¯æœåŠ¡æ­£å¸¸è¿è¡Œ
- [ ] å¥åº·æ£€æŸ¥æ¥å£è¿”å›æ­£å¸¸
- [ ] å®Œæˆäº†1,2,4,8ä¸ªPodçš„æµ‹è¯•
- [ ] æ”¶é›†äº†å®Œæ•´çš„æ€§èƒ½æ•°æ®
- [ ] ç”Ÿæˆäº†HTMLå’ŒCSVæŠ¥å‘Š
- [ ] å¡«å†™äº†å®éªŒæŠ¥å‘Šæ¨¡æ¿
- [ ] åˆ†æäº†åˆ†å¸ƒå¼ç³»ç»ŸæŒ‘æˆ˜
- [ ] æŠ¥å‘Šå­—æ•°ç¬¦åˆè¦æ±‚ï¼ˆ1500å­—ä»¥å†…ï¼‰
- [ ] åŒ…å«äº†ä¸ªäººä¿¡æ¯ï¼ˆå§“åã€å­¦å·ç­‰ï¼‰

## ğŸ¯ æäº¤è¦æ±‚

æ ¹æ®Assignmentè¦æ±‚ï¼Œæ‚¨éœ€è¦æäº¤ï¼š

1. **å®éªŒæŠ¥å‘Š** (PDFæ ¼å¼)
   - ä½¿ç”¨12pt Timeså­—ä½“
   - å•æ ï¼Œ1è‹±å¯¸è¾¹è·
   - åŒ…å«å®Œæ•´çš„ä¸ªäººä¿¡æ¯
   - æœ€å¤š1500å­—ï¼ˆä¸åŒ…æ‹¬è¡¨æ ¼ï¼‰

2. **å®éªŒæ•°æ®** (å¯é€‰)
   - CSVæ ¼å¼çš„åŸå§‹æ•°æ®
   - Locustç”Ÿæˆçš„HTMLæŠ¥å‘Š

3. **ä»£ç æ–‡ä»¶** (å¦‚æœè¦æ±‚)
   - locustfile.py
   - å…¶ä»–ç›¸å…³è„šæœ¬

## ğŸ’¡ é¢å¤–å»ºè®®

1. **å¤šæ¬¡è¿è¡Œ**: æ¯ä¸ªé…ç½®è‡³å°‘è¿è¡Œ2-3æ¬¡ä»¥ç¡®ä¿ç»“æœç¨³å®š
2. **ç›‘æ§èµ„æº**: è®°å½•CPUã€å†…å­˜ä½¿ç”¨æƒ…å†µ
3. **ç½‘ç»œåˆ†æ**: è€ƒè™‘ç½‘ç»œå»¶è¿Ÿå¯¹ç»“æœçš„å½±å“
4. **é”™è¯¯åˆ†æ**: è¯¦ç»†åˆ†æå¤±è´¥è¯·æ±‚çš„åŸå› 
5. **å¯è§†åŒ–**: è€ƒè™‘æ·»åŠ å›¾è¡¨æ¥å±•ç¤ºè¶‹åŠ¿

## ğŸ“ è·å–å¸®åŠ©

å¦‚æœé‡åˆ°é—®é¢˜ï¼Œå¯ä»¥ï¼š

1. æŸ¥çœ‹Locustå®˜æ–¹æ–‡æ¡£: https://docs.locust.io/
2. æ£€æŸ¥Kubernetesæ–‡æ¡£: https://kubernetes.io/docs/
3. æŸ¥çœ‹é¡¹ç›®READMEæ–‡ä»¶
4. è”ç³»å¯¼å¸ˆæˆ–åŒå­¦è®¨è®º

---

**ç¥æ‚¨å®éªŒé¡ºåˆ©ï¼** ğŸ‰

è®°ä½ï¼Œå®éªŒçš„ç›®æ ‡ä¸ä»…æ˜¯æ”¶é›†æ•°æ®ï¼Œæ›´é‡è¦çš„æ˜¯ç†è§£ç³»ç»Ÿçš„æ€§èƒ½ç‰¹å¾å’Œæ‰©å±•æ€§é™åˆ¶ã€‚é€šè¿‡è¿™ä¸ªå®éªŒï¼Œæ‚¨å°†æ·±å…¥äº†è§£åˆ†å¸ƒå¼ç³»ç»Ÿçš„å®é™…è¡¨ç°å’ŒæŒ‘æˆ˜ã€‚